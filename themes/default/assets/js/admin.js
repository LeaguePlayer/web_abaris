// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    var bindCabinetEvents, hide_popover;
    alertify.set({
      labels: {
        ok: "Ок",
        cancel: "Отмена"
      }
    });
    alertify.set({
      buttonReverse: true
    });
    alertify.set({
      buttonFocus: "cancel"
    });
    hide_popover = function() {
      return $('.tooltip-msg').popover('destroy');
    };
    setTimeout(hide_popover, 5000);
    bindCabinetEvents = function() {
      var deleteCounter, form, grid;
      if ($('.print-page').size() > 0) {
        $('.print-page').printPage();
      }
      $.bind_rows_check();
      form = $('.abaris-form');
      $('.choose_usertype:radio', form).click(function(e) {
        if (parseInt($(this).val()) === 0) {
          return $('.organization', form).addClass('hidden');
        } else {
          return $('.organization', form).removeClass('hidden');
        }
      });
      $.mask.definitions['d'] = "[0-9]";
      form.find('#Profile_phone').mask("dddddddddd");
      $.bind_ajax_modal('.view-invoice, .view-order');
      grid = $('.catalog-grid').first();
      deleteCounter = $('.subtotal .delete .selected_count');
      $('.blue-check input:checkbox').change(function() {
        return deleteCounter.text(grid.find('.blue-check input:checkbox:checked').size());
      });
      $.bind_ajax_modal('.pencil, .subtotal .add', {
        afterShow: function() {
          var bindEvents;
          bindEvents = function(context) {
            form = $('form', context);
            form.find('#UserCarsSTO_maintenance_date').datepicker();
            return form.find('input:submit').click(function(e) {
              $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                success: function(data) {
                  if ($(data).find('#ajaxform').size() > 0) {
                    context.html(data);
                    bindEvents(context);
                    return $.fancybox.reposition();
                  } else {
                    $('#usercabinet-wrap').replaceWith(data);
                    bindCabinetEvents();
                    return $.fancybox.close();
                  }
                }
              });
              return false;
            });
          };
          return bindEvents($(this.inner));
        }
      });
      return $('.subtotal .delete').click(function(e) {
        form = $(this).parents('form');
        if (form.find('.blue-check input:checked').size() === 0) {
          alertify.alert("Вы не выбрали ни одной записи");
        } else {
          alertify.confirm("Подтвердите удаление выбранных элементов", function(e, str) {
            if (e) {
              form.append($('<input type="hidden" />').attr('name', 'action').attr('value', 'delete'));
              return $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                success: function(data) {
                  $('#usercabinet-wrap').replaceWith(data);
                  return bindCabinetEvents();
                }
              });
            }
          });
        }
        return false;
      });
    };
    return bindCabinetEvents();
  });

}).call(this);

/*
//@ sourceMappingURL=admin.map
*/
