// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    var bindUpdateCars, form, hide_popover;
    $('.tooltip-msg').popover({
      html: true,
      trigger: 'hover'
    });
    $('.tooltip-msg').popover('show');
    alertify.set({
      labels: {
        ok: "Ок",
        cancel: "Отмена"
      }
    });
    alertify.set({
      buttonReverse: true
    });
    alertify.set({
      buttonFocus: "cancel"
    });
    hide_popover = function() {
      return $('.tooltip-msg').popover('destroy');
    };
    setTimeout(hide_popover, 5000);
    form = $('.abaris-form');
    form.find(':radio').on('change', function() {
      if ($(this).attr('id') === 'ur') {
        return form.find('.organization').show();
      } else {
        return form.find('.organization').hide();
      }
    });
    bindUpdateCars = function() {
      var deleteCounter, grid;
      $.bind_rows_check();
      grid = $('.catalog-grid').first();
      deleteCounter = $('.subtotal .delete .selected_count');
      $('.blue-check input:checkbox').change(function() {
        return deleteCounter.text(grid.find('.blue-check input:checkbox:checked').size());
      });
      $.bind_ajax_modal('.pencil, .subtotal .add', {
        afterShow: function() {
          var bindEvents;
          bindEvents = function(context) {
            form = $('form', context);
            form.find('#UserCarsSTO_maintenance_date').datepicker();
            return form.find('input:submit').click(function(e) {
              $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                success: function(data) {
                  if ($(data).find('#ajaxform').size() > 0) {
                    context.html(data);
                    bindEvents(context);
                    return $.fancybox.reposition();
                  } else {
                    $('#usercabinet-wrap').replaceWith(data);
                    bindUpdateCars();
                    return $.fancybox.close();
                  }
                }
              });
              return false;
            });
          };
          return bindEvents($(this.inner));
        }
      });
      return $('.subtotal .delete').click(function(e) {
        form = $(this).parents('form');
        if (form.find('.blue-check input:checked').size() === 0) {
          alertify.alert("Вы не выбрали ни одной записи");
        } else {
          alertify.confirm("Подтвердите удаление выбранных элементов", function(e, str) {
            if (e) {
              form.append($('<input type="hidden" />').attr('name', 'action').attr('value', 'delete'));
              return $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                success: function(data) {
                  $('#usercabinet-wrap').replaceWith(data);
                  return bindUpdateCars();
                }
              });
            }
          });
        }
        return false;
      });
    };
    return bindUpdateCars();
  });

}).call(this);

/*
//@ sourceMappingURL=admin.map
*/
